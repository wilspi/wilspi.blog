<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Introduction to Elm with 2048 game</title><meta name=keywords content="elm,frontend,dev"><meta name=description content="​
In this post I will be creating a small game, 2048 in Elm. 2048 is a game created by gabrielecirulli which went viral in 2014.
I chose 2048 because the game mechanics are simple which will help us understand Elm clearly. Also, I didn&rsquo;t want to make another todo app.
You can play here.
​
The Game Mechanics? There are some number tiles on the board (4x4). The number on the tile will be a power of 2 with minimum being 2."><meta name=author content="wilspi"><link rel=canonical href=https://wilspi.com/p/2048-game-in-elmlang/><link href=/assets/css/stylesheet.min.720a15e8b032e95fd48451175bee1cd41c132eca839a662aca01a39adb67f126.css integrity="sha256-cgoV6LAy6V/UhFEXW+4c1BwTLsqDmmYqygGjmttn8SY=" rel="preload stylesheet" as=style><link rel=icon href=https://wilspi.com/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://wilspi.com/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wilspi.com/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://wilspi.com/favicons/apple-touch-icon.png><link rel=mask-icon href=https://wilspi.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta property="og:title" content="Introduction to Elm with 2048 game"><meta property="og:description" content="​
In this post I will be creating a small game, 2048 in Elm. 2048 is a game created by gabrielecirulli which went viral in 2014.
I chose 2048 because the game mechanics are simple which will help us understand Elm clearly. Also, I didn&rsquo;t want to make another todo app.
You can play here.
​
The Game Mechanics? There are some number tiles on the board (4x4). The number on the tile will be a power of 2 with minimum being 2."><meta property="og:type" content="article"><meta property="og:url" content="https://wilspi.com/p/2048-game-in-elmlang/"><meta property="og:image" content="https://wilspi.com/images/2048-cover.webp"><meta property="article:published_time" content="2020-08-08T15:00:00+05:30"><meta property="article:modified_time" content="2020-08-08T15:00:00+05:30"><meta property="og:site_name" content="wilspi.com"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wilspi.com/images/2048-cover.webp"><meta name=twitter:title content="Introduction to Elm with 2048 game"><meta name=twitter:description content="​
In this post I will be creating a small game, 2048 in Elm. 2048 is a game created by gabrielecirulli which went viral in 2014.
I chose 2048 because the game mechanics are simple which will help us understand Elm clearly. Also, I didn&rsquo;t want to make another todo app.
You can play here.
​
The Game Mechanics? There are some number tiles on the board (4x4). The number on the tile will be a power of 2 with minimum being 2."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://wilspi.com/"},{"@type":"ListItem","position":2,"name":"posts","item":"https://wilspi.com/posts/"},{"@type":"ListItem","position":3,"name":"Introduction to Elm with 2048 game","item":"https://wilspi.com/p/2048-game-in-elmlang/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Introduction to Elm with 2048 game","name":"Introduction to Elm with 2048 game","description":"​\nIn this post I will be creating a small game, 2048 in Elm. 2048 is a game created by gabrielecirulli which went viral in 2014.\nI chose 2048 because the game mechanics are simple …","keywords":["elm","frontend","dev"],"articleBody":"​\nIn this post I will be creating a small game, 2048 in Elm. 2048 is a game created by gabrielecirulli which went viral in 2014.\nI chose 2048 because the game mechanics are simple which will help us understand Elm clearly. Also, I didn’t want to make another todo app.\nYou can play here.\n​\nThe Game Mechanics? There are some number tiles on the board (4x4). The number on the tile will be a power of 2 with minimum being 2. See above image. You can press arrow keys: up, left, down, and right. This will trigger “merge” in the direction of the key-press. “merge” is the process of merging same number tiles into one and doubling its value. See below gif. The score is calculated by sum of number on tiles on the board, so you play to maximise your score by merging as many tiles as possible. A new tile (number 2) is introduced in the game at any random empty space with every key-press Game is over when no new tiles can be added, thats your final score (highest). Simple eh!\n​\nThe Elm Architecture Every Elm application follows the Elm Architecture, which is pretty straightforward.\nModel — the state of your application View — a way to turn your state into HTML Update — a way to update your state based on messages We won’t deep dive into each of them, you can read more about Elm here.\nLets dive into building the game.\n​\nBuilding the game in Elm Shaping Elm Architecture Based on the game’s functioning, let’s start defining the architecture of our game from Elm’s perspective:\nModel\nWe have to store every tile’s data (number on the tiles and position of the tile). To store these tiles, we can introduce a matrix of NxN (N being the number of rows/columns, here 4). We can also store tiles as a list but matrix will be easy to render and visualize.\nView\nSince we kept our Model close to our View, in View we have to render this matrix into a matrix, with CSS.\nUpdate\nIn Update function we will regenerate the Model (state) depending upon the message it receives. Let’s look at different kind of messages we must have:\nLeftMove: To enable merging leftwards RightMove: To enable merging rightwards UpMove: To enable merging upwards DownMove: To enable merging downwards Reset: For resetting the grid to the initial state AddTile: To add a tile at any random available space The structure of the game looks good, now we have to implement the handling of these messages.\n​\nDiving into our messages LeftMove\nLeftMove will merge same number tiles on a row in left direction. Since the tiles to be merged are in same list, we can do map-reduce for rows and merge 2 tiles with the same number into one and double the number on the tile. Lets look at the code below which merges tiles in a list and returns the list:\nmergeAndFillRow\nmergeAndFillRow : List Cell -\u003e List Cell mergeAndFillRow list = let updatedRow = mergeRow list in List.concat (updatedRow :: [ EmptyCell |\u003e List.repeat ((list |\u003e List.length) - (updatedRow |\u003e List.length)) ] ) mergeRow\nmergeRow : List Cell -\u003e List Cell mergeRow list = case list of [] -\u003e [] x1 :: xs -\u003e if x1 == EmptyCell then mergeRow xs else case xs of [] -\u003e [ x1 ] x2 :: xs2 -\u003e if x1 == x2 then mergeCell ( x1, x2 ) :: mergeRow xs2 else x1 :: mergeRow (x2 :: xs2) In mergeRow, we use recursion to reduce the list, and then in mergeAndFillRow we fill the list with empty tiles. Functional programming is fun!\nRightMove\nRightMove is LeftMove in the opposite direction (Thanks, I think). So we will reuse mergeAndFillRow. How? By reversing the List before and after calling this function.\nUpMove\nFor RightMove, and LeftMove, the merging operation is fairly easy since row elements are in a single list and therefore we can use List methods to reduce and merge tiles, but in UpMove case, the tiles are in multi columns, meaning items are in different lists. Here, elementary Mathematics comes to our rescue. We can transpose the matrix and then call the function mergeAndFillRow to implement UpMove.\nSince Elm is a functional programming language there are no looping (for/while) constructs, and this makes transpose little challenging.\nYou can refer to the code below, uses recursion:\ntransposeMap\ntransposeMap : Grid -\u003e Grid -\u003e Grid transposeMap grid2 grid1 = case Array.get 0 grid1 of Just e -\u003e transposeMap (grid2 |\u003e transposeForIdx 0 e) (grid1 |\u003e Array.slice 1 (grid1 |\u003e Array.length)) Nothing -\u003e grid2 transposeForIdx\ntransposeForIdx : Int -\u003e Array Cell -\u003e Grid -\u003e Grid transposeForIdx idx list grid2 = case Array.get 0 list of Just e -\u003e transposeForIdx (idx + 1) (list |\u003e Array.slice 1 (list |\u003e Array.length)) (case grid2 |\u003e Array.get idx of Just l -\u003e grid2 |\u003e Array.set idx (l |\u003e Array.push e) Nothing -\u003e grid2 |\u003e Array.push (Array.fromList [ e ]) ) Nothing -\u003e grid2 DownMove\nUsing the same technique as we did with RightMove, we can: reverse the list, transpose, call mergeAndFillRow, transpose again, and finally reverse.\nAddTile\nFor this will create a list of available positions of tiles by traversing the matrix, and then randomly adding number tile 2 on any one of available positions.\nReset\nReset is initializing the matrix and sending AddTile message.\n​\nMerging cells: mergeCell is a common function which merges 2 tiles (Cell) and returns one tile:\nswap : ( Cell, Cell ) -\u003e ( Cell, Cell ) swap ( cell1, cell2 ) = ( cell2, cell1 ) mergeCell : ( Cell, Cell ) -\u003e Cell mergeCell ( cell1, cell2 ) = case ( cell1, cell2 ) of ( Tile val1, Tile val2 ) -\u003e Tile (val1 + val2) ( Tile val1, EmptyCell ) -\u003e Tile val1 _ -\u003e mergeCell (swap ( cell1, cell2 )) Note: The above mergeCell method fails when arguments are EmptyCell and EmptyCell, it gets stuck in infinite recursion. But since we never have that case, it never crashes.\n​\nSubscriptions For integrating key-presses and touch coordinates, we will use subscriptions.\nGame is ready, now time for icing on the cake.\n​\nAdding CSS I have replicated same color codes as in the original game.\nYou can look at the complete code here.\n","wordCount":"1061","inLanguage":"en","image":"https://wilspi.com/images/2048-cover.webp","datePublished":"2020-08-08T15:00:00+05:30","dateModified":"2020-08-08T15:00:00+05:30","author":{"@type":"Person","name":"wilspi"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wilspi.com/p/2048-game-in-elmlang/"},"publisher":{"@type":"Organization","name":"wilspi","logo":{"@type":"ImageObject","url":"https://wilspi.com/favicons/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://wilspi.com accesskey=h title="wilspi (Alt + H)">wilspi</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://wilspi.com/ title=Home><span>🏠</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Introduction to Elm with 2048 game</h1><div class=post-meta>5 min</div></header><figure class=entry-cover><img src=https://wilspi.com/images/2048-cover.webp alt="play 2048"></figure><div class=post-content><p>​</p><p>In this post I will be creating a small game, <strong><a href=https://wilspi.com/elm-2048/>2048</a></strong> in Elm. 2048 is a game created by <a href=https://github.com/gabrielecirulli/2048>gabrielecirulli</a> which went viral in 2014.</p><p>I chose 2048 because the game mechanics are simple which will help us understand Elm clearly. Also, I didn&rsquo;t want to make another todo app.</p><p>You can play <strong><a href=/elm-2048>here</a></strong>.</p><p>​</p><h2 id=the-game-mechanics>The Game Mechanics?<a hidden class=anchor aria-hidden=true href=#the-game-mechanics>#</a></h2><ul><li>There are some number tiles on the board (4x4). The number on the tile will be a power of 2 with minimum being 2.
See above image.</li><li>You can press arrow keys: up, left, down, and right. This will trigger &ldquo;merge&rdquo; in the direction of the key-press. &ldquo;merge&rdquo; is the process of merging same number tiles into one and doubling its value. See below gif.</li><li>The score is calculated by sum of number on tiles on the board, so you play to maximise your score by merging as many tiles as possible.</li><li>A new tile (number 2) is introduced in the game at any random empty space with every key-press</li><li>Game is over when no new tiles can be added, thats your final score (highest).</li></ul><p>Simple eh!</p><p>​</p><h2 id=the-elm-architecture>The Elm Architecture<a hidden class=anchor aria-hidden=true href=#the-elm-architecture>#</a></h2><p>Every Elm application follows the Elm Architecture, which is pretty straightforward.</p><ul><li><strong>Model</strong> — the state of your application</li><li><strong>View</strong> — a way to turn your state into HTML</li><li><strong>Update</strong> — a way to update your state based on messages</li></ul><p>We won&rsquo;t deep dive into each of them, you can read more about Elm <a href=notes.wilspi.com>here</a>.</p><p>Lets dive into building the game.</p><p>​</p><h2 id=building-the-game-in-elm>Building the game in Elm<a hidden class=anchor aria-hidden=true href=#building-the-game-in-elm>#</a></h2><h3 id=shaping-elm-architecture>Shaping Elm Architecture<a hidden class=anchor aria-hidden=true href=#shaping-elm-architecture>#</a></h3><p>Based on the game&rsquo;s functioning, let&rsquo;s start defining the architecture of our game from Elm&rsquo;s perspective:</p><p><strong>Model</strong><br>We have to store every tile&rsquo;s data (number on the tiles and position of the tile). To store these tiles, we can introduce a matrix of <code>N</code>x<code>N</code> (<code>N</code> being the number of rows/columns, here 4).
We can also store tiles as a list but matrix will be easy to render and visualize.</p><p><strong>View</strong><br>Since we kept our Model close to our View, in View we have to render this matrix into a matrix, with CSS.</p><p><strong>Update</strong><br>In Update function we will regenerate the Model (state) depending upon the message it receives. Let&rsquo;s look at different kind of messages we must have:</p><ul><li><code>LeftMove</code>: To enable merging leftwards</li><li><code>RightMove</code>: To enable merging rightwards</li><li><code>UpMove</code>: To enable merging upwards</li><li><code>DownMove</code>: To enable merging downwards</li><li><code>Reset</code>: For resetting the grid to the initial state</li><li><code>AddTile</code>: To add a tile at any random available space</li></ul><p>The structure of the game looks good, now we have to implement the handling of these messages.</p><p>​</p><h3 id=diving-into-our-messages>Diving into our messages<a hidden class=anchor aria-hidden=true href=#diving-into-our-messages>#</a></h3><ul><li><p><strong><code>LeftMove</code></strong></p><p><code>LeftMove</code> will merge same number tiles on a row in left direction. Since the tiles to be merged are in same list, we can do map-reduce for rows and merge 2 tiles with the same number into one and double the number on the tile.
Lets look at the code below which merges tiles in a list and returns the list:</p><p><code>mergeAndFillRow</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elm data-lang=elm><span style=display:flex><span>mergeAndFillRow <span style=color:#a6e22e>:</span> <span style=color:#66d9ef>List</span> <span style=color:#66d9ef>Cell</span> <span style=color:#a6e22e>-&gt;</span> <span style=color:#66d9ef>List</span> <span style=color:#66d9ef>Cell</span>
</span></span><span style=display:flex><span>mergeAndFillRow list <span style=color:#a6e22e>=</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span>
</span></span><span style=display:flex><span>      updatedRow <span style=color:#a6e22e>=</span>
</span></span><span style=display:flex><span>          mergeRow list
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>List</span><span style=color:#a6e22e>.</span>concat
</span></span><span style=display:flex><span>      (updatedRow
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>::</span> [ <span style=color:#66d9ef>EmptyCell</span>
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>|&gt;</span> <span style=color:#66d9ef>List</span><span style=color:#a6e22e>.</span>repeat
</span></span><span style=display:flex><span>                      ((list <span style=color:#a6e22e>|&gt;</span> <span style=color:#66d9ef>List</span><span style=color:#a6e22e>.</span>length) <span style=color:#a6e22e>-</span> (updatedRow <span style=color:#a6e22e>|&gt;</span> <span style=color:#66d9ef>List</span><span style=color:#a6e22e>.</span>length))
</span></span><span style=display:flex><span>             ]
</span></span><span style=display:flex><span>      )
</span></span></code></pre></div><p><code>mergeRow</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elm data-lang=elm><span style=display:flex><span>mergeRow <span style=color:#a6e22e>:</span> <span style=color:#66d9ef>List</span> <span style=color:#66d9ef>Cell</span> <span style=color:#a6e22e>-&gt;</span> <span style=color:#66d9ef>List</span> <span style=color:#66d9ef>Cell</span>
</span></span><span style=display:flex><span>mergeRow list <span style=color:#a6e22e>=</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>case</span> list <span style=color:#66d9ef>of</span>
</span></span><span style=display:flex><span>      [] <span style=color:#a6e22e>-&gt;</span>
</span></span><span style=display:flex><span>          []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      x<span style=color:#ae81ff>1</span> <span style=color:#a6e22e>::</span> xs <span style=color:#a6e22e>-&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> x<span style=color:#ae81ff>1</span> <span style=color:#a6e22e>==</span> <span style=color:#66d9ef>EmptyCell</span> <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>              mergeRow xs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>case</span> xs <span style=color:#66d9ef>of</span>
</span></span><span style=display:flex><span>                  [] <span style=color:#a6e22e>-&gt;</span>
</span></span><span style=display:flex><span>                      [ x<span style=color:#ae81ff>1</span> ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                  x<span style=color:#ae81ff>2</span> <span style=color:#a6e22e>::</span> xs<span style=color:#ae81ff>2</span> <span style=color:#a6e22e>-&gt;</span>
</span></span><span style=display:flex><span>                      <span style=color:#66d9ef>if</span> x<span style=color:#ae81ff>1</span> <span style=color:#a6e22e>==</span> x<span style=color:#ae81ff>2</span> <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                          mergeCell ( x<span style=color:#ae81ff>1</span>, x<span style=color:#ae81ff>2</span> ) <span style=color:#a6e22e>::</span> mergeRow xs<span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                      <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>                          x<span style=color:#ae81ff>1</span> <span style=color:#a6e22e>::</span> mergeRow (x<span style=color:#ae81ff>2</span> <span style=color:#a6e22e>::</span> xs<span style=color:#ae81ff>2</span>)
</span></span></code></pre></div><p>In <code>mergeRow</code>, we use recursion to reduce the list, and then in <code>mergeAndFillRow</code> we fill the list with empty tiles. Functional programming is fun!</p></li><li><p><strong><code>RightMove</code></strong></p><p><code>RightMove</code> is <code>LeftMove</code> in the opposite direction (Thanks, I think). So we will reuse <code>mergeAndFillRow</code>. How? By reversing the <code>List</code> before and after calling this function.</p></li><li><p><strong><code>UpMove</code></strong></p><p>For <code>RightMove</code>, and <code>LeftMove</code>, the merging operation is fairly easy since row elements are in a single list and therefore we can use <code>List</code> methods to reduce and merge tiles, but in <code>UpMove</code> case, the tiles are in multi columns, meaning items are in different lists.
Here, elementary Mathematics comes to our rescue. We can <a href=https://en.wikipedia.org/wiki/Transpose>transpose</a> the matrix and then call the function <code>mergeAndFillRow</code> to implement <code>UpMove</code>.<br>Since Elm is a functional programming language there are no looping (for/while) constructs, and this makes transpose little challenging.</p><p>You can refer to the code below, uses <strong>recursion</strong>:</p><p><code>transposeMap</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elm data-lang=elm><span style=display:flex><span>transposeMap <span style=color:#a6e22e>:</span> <span style=color:#66d9ef>Grid</span> <span style=color:#a6e22e>-&gt;</span> <span style=color:#66d9ef>Grid</span> <span style=color:#a6e22e>-&gt;</span> <span style=color:#66d9ef>Grid</span>
</span></span><span style=display:flex><span>transposeMap grid<span style=color:#ae81ff>2</span> grid<span style=color:#ae81ff>1</span> <span style=color:#a6e22e>=</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>Array</span><span style=color:#a6e22e>.</span>get <span style=color:#ae81ff>0</span> grid<span style=color:#ae81ff>1</span> <span style=color:#66d9ef>of</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>Just</span> e <span style=color:#a6e22e>-&gt;</span>
</span></span><span style=display:flex><span>          transposeMap (grid<span style=color:#ae81ff>2</span> <span style=color:#a6e22e>|&gt;</span> transposeForIdx <span style=color:#ae81ff>0</span> e) (grid<span style=color:#ae81ff>1</span> <span style=color:#a6e22e>|&gt;</span> <span style=color:#66d9ef>Array</span><span style=color:#a6e22e>.</span>slice <span style=color:#ae81ff>1</span> (grid<span style=color:#ae81ff>1</span> <span style=color:#a6e22e>|&gt;</span> <span style=color:#66d9ef>Array</span><span style=color:#a6e22e>.</span>length))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>Nothing</span> <span style=color:#a6e22e>-&gt;</span>
</span></span><span style=display:flex><span>          grid<span style=color:#ae81ff>2</span>
</span></span></code></pre></div><p><code>transposeForIdx</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elm data-lang=elm><span style=display:flex><span>transposeForIdx <span style=color:#a6e22e>:</span> <span style=color:#66d9ef>Int</span> <span style=color:#a6e22e>-&gt;</span> <span style=color:#66d9ef>Array</span> <span style=color:#66d9ef>Cell</span> <span style=color:#a6e22e>-&gt;</span> <span style=color:#66d9ef>Grid</span> <span style=color:#a6e22e>-&gt;</span> <span style=color:#66d9ef>Grid</span>
</span></span><span style=display:flex><span>transposeForIdx idx list grid<span style=color:#ae81ff>2</span> <span style=color:#a6e22e>=</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>Array</span><span style=color:#a6e22e>.</span>get <span style=color:#ae81ff>0</span> list <span style=color:#66d9ef>of</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>Just</span> e <span style=color:#a6e22e>-&gt;</span>
</span></span><span style=display:flex><span>          transposeForIdx (idx <span style=color:#a6e22e>+</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>              (list <span style=color:#a6e22e>|&gt;</span> <span style=color:#66d9ef>Array</span><span style=color:#a6e22e>.</span>slice <span style=color:#ae81ff>1</span> (list <span style=color:#a6e22e>|&gt;</span> <span style=color:#66d9ef>Array</span><span style=color:#a6e22e>.</span>length))
</span></span><span style=display:flex><span>              (<span style=color:#66d9ef>case</span> grid<span style=color:#ae81ff>2</span> <span style=color:#a6e22e>|&gt;</span> <span style=color:#66d9ef>Array</span><span style=color:#a6e22e>.</span>get idx <span style=color:#66d9ef>of</span>
</span></span><span style=display:flex><span>                  <span style=color:#66d9ef>Just</span> l <span style=color:#a6e22e>-&gt;</span>
</span></span><span style=display:flex><span>                      grid<span style=color:#ae81ff>2</span> <span style=color:#a6e22e>|&gt;</span> <span style=color:#66d9ef>Array</span><span style=color:#a6e22e>.</span>set idx (l <span style=color:#a6e22e>|&gt;</span> <span style=color:#66d9ef>Array</span><span style=color:#a6e22e>.</span>push e)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                  <span style=color:#66d9ef>Nothing</span> <span style=color:#a6e22e>-&gt;</span>
</span></span><span style=display:flex><span>                      grid<span style=color:#ae81ff>2</span> <span style=color:#a6e22e>|&gt;</span> <span style=color:#66d9ef>Array</span><span style=color:#a6e22e>.</span>push (<span style=color:#66d9ef>Array</span><span style=color:#a6e22e>.</span>fromList [ e ])
</span></span><span style=display:flex><span>              )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>Nothing</span> <span style=color:#a6e22e>-&gt;</span>
</span></span><span style=display:flex><span>          grid<span style=color:#ae81ff>2</span>
</span></span></code></pre></div></li><li><p><strong><code>DownMove</code></strong></p><p>Using the same technique as we did with <code>RightMove</code>, we can: reverse the list, transpose, call <code>mergeAndFillRow</code>, transpose again, and finally reverse.</p></li><li><p><strong><code>AddTile</code></strong></p><p>For this will create a list of available positions of tiles by traversing the matrix, and then randomly adding number tile 2 on any one of available positions.</p></li><li><p><strong><code>Reset</code></strong></p><p>Reset is initializing the matrix and sending <code>AddTile</code> message.</p></li></ul><p>​</p><h3 id=merging-cells>Merging cells:<a hidden class=anchor aria-hidden=true href=#merging-cells>#</a></h3><p><code>mergeCell</code> is a common function which merges 2 tiles (Cell) and returns one tile:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elm data-lang=elm><span style=display:flex><span>swap <span style=color:#a6e22e>:</span> ( <span style=color:#66d9ef>Cell</span>, <span style=color:#66d9ef>Cell</span> ) <span style=color:#a6e22e>-&gt;</span> ( <span style=color:#66d9ef>Cell</span>, <span style=color:#66d9ef>Cell</span> )
</span></span><span style=display:flex><span>swap ( cell<span style=color:#ae81ff>1</span>, cell<span style=color:#ae81ff>2</span> ) <span style=color:#a6e22e>=</span>
</span></span><span style=display:flex><span>    ( cell<span style=color:#ae81ff>2</span>, cell<span style=color:#ae81ff>1</span> )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mergeCell <span style=color:#a6e22e>:</span> ( <span style=color:#66d9ef>Cell</span>, <span style=color:#66d9ef>Cell</span> ) <span style=color:#a6e22e>-&gt;</span> <span style=color:#66d9ef>Cell</span>
</span></span><span style=display:flex><span>mergeCell ( cell<span style=color:#ae81ff>1</span>, cell<span style=color:#ae81ff>2</span> ) <span style=color:#a6e22e>=</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> ( cell<span style=color:#ae81ff>1</span>, cell<span style=color:#ae81ff>2</span> ) <span style=color:#66d9ef>of</span>
</span></span><span style=display:flex><span>        ( <span style=color:#66d9ef>Tile</span> val<span style=color:#ae81ff>1</span>, <span style=color:#66d9ef>Tile</span> val<span style=color:#ae81ff>2</span> ) <span style=color:#a6e22e>-&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>Tile</span> (val<span style=color:#ae81ff>1</span> <span style=color:#a6e22e>+</span> val<span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        ( <span style=color:#66d9ef>Tile</span> val<span style=color:#ae81ff>1</span>, <span style=color:#66d9ef>EmptyCell</span> ) <span style=color:#a6e22e>-&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>Tile</span> val<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        _ <span style=color:#a6e22e>-&gt;</span>
</span></span><span style=display:flex><span>            mergeCell (swap ( cell<span style=color:#ae81ff>1</span>, cell<span style=color:#ae81ff>2</span> ))
</span></span></code></pre></div><p>Note: The above <code>mergeCell</code> method fails when arguments are <code>EmptyCell</code> and <code>EmptyCell</code>, it gets stuck in infinite recursion. But since we never have that case, it never crashes.</p><p>​</p><h3 id=subscriptions>Subscriptions<a hidden class=anchor aria-hidden=true href=#subscriptions>#</a></h3><p>For integrating key-presses and touch coordinates, we will use <a href=https://elmprogramming.com/subscriptions.html#subscription>subscriptions</a>.</p><p>Game is ready, now time for icing on the cake.</p><p>​</p><h3 id=adding-css>Adding CSS<a hidden class=anchor aria-hidden=true href=#adding-css>#</a></h3><p>I have replicated same color codes as in the original game.</p><p>You can look at the complete code <a href=https://github.com/wilspi/elm-2048/blob/master/src/Main.elm>here</a>.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://wilspi.com/tags/elm/>elm</a></li><li><a href=https://wilspi.com/tags/frontend/>frontend</a></li><li><a href=https://wilspi.com/tags/dev/>dev</a></li></ul><div class=share-heading>sharing is caring</div><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Introduction to Elm with 2048 game on twitter" href="https://twitter.com/intent/tweet/?text=Introduction%20to%20Elm%20with%202048%20game by @iamwilspi&amp;url=https%3a%2f%2fwilspi.com%2fp%2f2048-game-in-elmlang%2f&amp;hashtags=elm%2cfrontend%2cdev"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Introduction to Elm with 2048 game on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwilspi.com%2fp%2f2048-game-in-elmlang%2f&amp;title=Introduction%20to%20Elm%20with%202048%20game&amp;summary=Introduction%20to%20Elm%20with%202048%20game&amp;source=https%3a%2f%2fwilspi.com%2fp%2f2048-game-in-elmlang%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Introduction to Elm with 2048 game on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwilspi.com%2fp%2f2048-game-in-elmlang%2f&title=Introduction%20to%20Elm%20with%202048%20game"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Introduction to Elm with 2048 game on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwilspi.com%2fp%2f2048-game-in-elmlang%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Introduction to Elm with 2048 game on whatsapp" href="https://api.whatsapp.com/send?text=Introduction%20to%20Elm%20with%202048%20game%20-%20https%3a%2f%2fwilspi.com%2fp%2f2048-game-in-elmlang%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://wilspi.com>wilspi</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById("menu").scrollLeft=localStorage.getItem("menu-scroll-position"))},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})});var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById("menu").scrollLeft)}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>