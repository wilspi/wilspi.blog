<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Nix shell and Awesomeness: An Intro | Sourabh Deokar</title>

<meta name="keywords" content="nix, package-manager" />
<meta name="description" content="Last year while working with @amitu, I came across this wonderful tool called Nix.
About Nix, its wiki says:
 Nix is a package manager and build system that parses reproducible build instructions specified in the Nix Expression Language, a pure functional language with lazy evaluation
 Nix maintains the package versions including system libraries across OS environments and, hence never uses dependencies from the host system. All the version information is saved in your nix recipe (which you invoke through nix-shell command, we will see below).">
<meta name="author" content="wilspi">
<link rel="canonical" href="https://wilspi.com/post/tech/nix-shell-and-awesomeness/" />
<link href="/assets/css/stylesheet.min.f580a29692e0c7eb72865ec0bd4ee916bef2dc7e85f4fbfdf6a609b3a0f4f6a1.css" integrity="sha256-9YCilpLgx&#43;tyhl7AvU7pFr7y3H6F9Pv99qYJs6D09qE=" rel="preload stylesheet"
    as="style">

<link rel="icon" href="https://wilspi.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://wilspi.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://wilspi.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://wilspi.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://wilspi.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.79.0" />



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-51915090-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<meta property="og:title" content="Nix shell and Awesomeness: An Intro" />
<meta property="og:description" content="Last year while working with @amitu, I came across this wonderful tool called Nix.
About Nix, its wiki says:
 Nix is a package manager and build system that parses reproducible build instructions specified in the Nix Expression Language, a pure functional language with lazy evaluation
 Nix maintains the package versions including system libraries across OS environments and, hence never uses dependencies from the host system. All the version information is saved in your nix recipe (which you invoke through nix-shell command, we will see below)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://wilspi.com/post/tech/nix-shell-and-awesomeness/" />
<meta property="og:image" content="https://wilspi.com/images/cover.jpg"/>
<meta property="article:published_time" content="2020-07-30T22:00:00+05:30" />
<meta property="article:modified_time" content="2020-07-30T22:00:00+05:30" /><meta property="og:site_name" content="नमस्ते" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://wilspi.com/images/cover.jpg"/>

<meta name="twitter:title" content="Nix shell and Awesomeness: An Intro"/>
<meta name="twitter:description" content="Last year while working with @amitu, I came across this wonderful tool called Nix.
About Nix, its wiki says:
 Nix is a package manager and build system that parses reproducible build instructions specified in the Nix Expression Language, a pure functional language with lazy evaluation
 Nix maintains the package versions including system libraries across OS environments and, hence never uses dependencies from the host system. All the version information is saved in your nix recipe (which you invoke through nix-shell command, we will see below)."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://wilspi.com/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Nix shell and Awesomeness: An Intro",
      "item": "https://wilspi.com/post/tech/nix-shell-and-awesomeness/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Nix shell and Awesomeness: An Intro",
  "name": "Nix shell and Awesomeness: An Intro",
  "description": "Last year while working with @amitu, I came across this wonderful tool called Nix.\nAbout Nix, its wiki says:\n Nix is a package manager and build system that parses reproducible …",
  "keywords": [
    "nix", "package-manager"
  ],
  "articleBody": "Last year while working with @amitu, I came across this wonderful tool called Nix.\nAbout Nix, its wiki says:\n Nix is a package manager and build system that parses reproducible build instructions specified in the Nix Expression Language, a pure functional language with lazy evaluation\n Nix maintains the package versions including system libraries across OS environments and, hence never uses dependencies from the host system. All the version information is saved in your nix recipe (which you invoke through nix-shell command, we will see below). This way, Nix can be used to create a virtual environment.\nLets setup an environment using nix-shell This is a recipe for creating environment with python 3.7.\n  Lets create shell.nix file with:\nwith import  {}; with pkgs.python27Packages; stdenv.mkDerivation { name = \"python-env\"; buildInputs = [ python37 python37Packages.pip python37Packages.virtualenv ]; SOURCE_DATE_EPOCH = 315532800; PROJDIR = \"${toString ./.}\"; shellHook = '' echo \"Using ${python37.name}\" [ ! -d '$PROJDIR/python-dev' ] \u0026\u0026 virtualenv python-dev \u0026\u0026 echo \"SETUP python-dev: DONE\" source python-dev/bin/activate # python -m pip install -r requirements.txt ''; }   Run:\nnix-shell --pure shell.nix\n--pure flag will create an environment that more closely corresponds to the “real” Nix build\n  This will download Python 3.7 and all its dependencies, build it and start a nix virtual environment.\nNix Recipes I have been using Nix for almost all my projects now. I have written nix recipes for creating virtual envs for:\n rust python nodejs postgres, etc.  With Nix, Life is Awesome  Nix allows to have multiple versions or variants of a package installed at the same time, especially important when different applications have dependencies on different versions of the same package Nix never uses host dependencies (“global” locations like /usr/bin), it always builds with exactly precise dependencies every time, and will always refer to them from then on. Nix lets you roll back changes atomically, even upgrades are atomic. nix-shell lets you make build environments that are totally reproducible across machines, and don’t interfere with each other.  Read all features here.\nIssues I faced  Nix will store multiple versions of your builds, this will use lot of your disk space. You will need to clean-up regularly using Nix garbage-collector. This is the price of having multiple generations, multiple profiles, multiple versions of software, the price of having many possibilities. Configuration (toolchain etc) for CLion/PyCharm gets reset whenever I update the packages, or switch between projects with different versions.  Extra  NixOS based on the Nix package manager and build system. Nix Expression Language is a pure, lazy, functional language, to describe packages, compositions of packages, and the variability within packages. We do use this for writing our nix recipes, but it is simple to understand unless you are doing very complicated stuff. Nix can also be used as your home manager but I am yet to try it.   ",
  "wordCount" : "467",
  "inLanguage": "en",
  "datePublished": "2020-07-30T22:00:00+05:30",
  "dateModified": "2020-07-30T22:00:00+05:30",
  "author":{
    "@type": "Person",
    "name": "wilspi"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://wilspi.com/post/tech/nix-shell-and-awesomeness/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Sourabh Deokar",
    "logo": {
      "@type": "ImageObject",
      "url": "https://wilspi.com/favicon.ico"
    }
  }
}
</script>





</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://wilspi.com" accesskey="h" title="Sourabh Deokar (Alt + H)">Sourabh Deokar</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                
                
            </span>
        </div>
        <ul id="menu" onscroll="menu_on_scroll()">
            <li>
                <a href="https://wilspi.com/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://notes.wilspi.com" title="Notes">
                    <span>Notes</span>
                </a>
            </li></ul>
    </nav>
</header>

    <main class="main">

<article class="post-single">
  <header class="post-header">

    <h1 class="post-title">
      Nix shell and Awesomeness: An Intro
    </h1>
    <div class="post-meta">

July 30, 2020&nbsp;·&nbsp;3 min&nbsp;·&nbsp;wilspi

</div>
  </header> 

  <div class="post-content">
<p>Last year while working with <a href="https://github.com/amitu/">@amitu</a>, I came across this wonderful tool called <a href="https://nixos.wiki/wiki/Nix">Nix</a>.</p>
<p>About Nix, its wiki says:</p>
<blockquote>
<p>Nix is a package manager and build system that parses reproducible build instructions specified in the <a href="https://nixos.wiki/wiki/Nix_Expression_Language">Nix Expression Language</a>, a pure functional language with lazy evaluation</p>
</blockquote>
<p>Nix maintains the package versions including system libraries across OS environments and, hence never uses dependencies from the host system. All the version information is saved in your nix recipe (which you invoke through <code>nix-shell</code> command, we will see below).
This way, Nix can be used to create a virtual environment.</p>
<h2 id="lets-setup-an-environment-using-nix-shell">Lets setup an environment using <code>nix-shell</code><a hidden class="anchor" aria-hidden="true" href="#lets-setup-an-environment-using-nix-shell">#</a></h2>
<p>This is a recipe for creating environment with <code>python 3.7</code>.</p>
<ul>
<li>
<p>Lets create <code>shell.nix</code> file with:</p>
<pre><code>with import &lt;nixpkgs&gt; {};
with pkgs.python27Packages;

stdenv.mkDerivation {
  name = &quot;python-env&quot;;

  buildInputs = [
    python37
    python37Packages.pip
    python37Packages.virtualenv
  ];

  SOURCE_DATE_EPOCH = 315532800;
  PROJDIR = &quot;${toString ./.}&quot;;

  shellHook = ''
    echo &quot;Using ${python37.name}&quot;

    [ ! -d '$PROJDIR/python-dev' ] &amp;&amp; virtualenv python-dev &amp;&amp; echo &quot;SETUP python-dev: DONE&quot;
    source python-dev/bin/activate
    # python -m pip install -r requirements.txt
  '';
}
</code></pre></li>
<li>
<p>Run:<br>
<code>nix-shell --pure shell.nix</code></p>
<p><code>--pure</code> flag  will create an environment that more closely corresponds to the &ldquo;real&rdquo; Nix build</p>
</li>
</ul>
<p>This will download <code>Python 3.7</code> and all its dependencies, build it and start a nix virtual environment.</p>
<h2 id="nix-recipes">Nix Recipes<a hidden class="anchor" aria-hidden="true" href="#nix-recipes">#</a></h2>
<p>I have been using Nix for almost all my projects now. I have written <a href="/post/tech/nix-recipes">nix recipes</a> for creating virtual envs for:</p>
<ul>
<li><a href="https://notes.wilspi.com/wiki/dev/technologies/nix/rust">rust</a></li>
<li><a href="https://notes.wilspi.com/wiki/dev/technologies/nix/python">python</a></li>
<li><a href="https://notes.wilspi.com/wiki/dev/technologies/nix/nodejs">nodejs</a></li>
<li><a href="https://notes.wilspi.com/wiki/dev/technologies/nix/postgresql">postgres</a>, etc.</li>
</ul>
<h2 id="with-nix-life-is-awesome">With Nix, Life is Awesome<a hidden class="anchor" aria-hidden="true" href="#with-nix-life-is-awesome">#</a></h2>
<ul>
<li>Nix allows to have <strong>multiple versions or variants of a package</strong> installed at the same time, especially important when different applications have dependencies on different versions of the same package</li>
<li>Nix <strong>never uses host dependencies</strong> (“global” locations like <code>/usr/bin</code>), it always builds with exactly precise dependencies every time, and will always refer to them from then on.</li>
<li>Nix lets you <strong>roll back changes atomically</strong>, even upgrades are atomic.</li>
<li><code>nix-shell</code> lets you make build environments that are totally <strong>reproducible across machines</strong>, and don’t interfere with each other.</li>
</ul>
<p>Read all features <a href="https://nixos.org/features.html">here</a>.</p>
<h2 id="issues-i-faced">Issues I faced<a hidden class="anchor" aria-hidden="true" href="#issues-i-faced">#</a></h2>
<ul>
<li>Nix will store multiple versions of your builds, this will use lot of your disk space. You will need to clean-up regularly using Nix <a href="https://nixos.org/nixos/nix-pills/garbage-collector.html">garbage-collector</a>. This is the price of having multiple generations, multiple profiles, multiple versions of software, the <strong>price of having many possibilities</strong>.</li>
<li>Configuration (toolchain etc) for CLion/PyCharm gets reset whenever I update the packages, or switch between projects with different versions.</li>
</ul>
<h2 id="extra">Extra<a hidden class="anchor" aria-hidden="true" href="#extra">#</a></h2>
<ul>
<li><a href="https://nixos.wiki/wiki/NixOS">NixOS</a> based on the Nix package manager and build system.</li>
<li><a href="https://nixos.wiki/wiki/Nix_Expression_Language">Nix Expression Language</a> is a pure, lazy, functional language, to describe packages, compositions of packages, and the variability within packages.
We do use this for writing our nix recipes, but it is simple to understand unless you are doing very complicated stuff.</li>
<li>Nix can also be used as your <a href="https://nixos.wiki/wiki/Home_Manager">home manager</a> but I am yet to try it.
<!-- raw HTML omitted -->
</li>
</ul>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->

</div>
  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://wilspi.com/tags/nix/">nix</a></li>
      <li><a href="https://wilspi.com/tags/package-manager/">package-manager</a></li>
    </ul>
  </footer>
</article>
    </main><footer class="footer">
    <span>&copy; 2021 <a href="https://wilspi.com">Sourabh Deokar</a></span>
    <span>&middot;</span>
    <span>Powered by <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a></span>
    <span>&middot;</span>
    <span>Theme <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>



<script defer src="/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js" integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w="
    onload="hljs.initHighlightingOnLoad();"></script>
<script>
    window.onload = function () {
        if (localStorage.getItem("menu-scroll-position")) {
            document.getElementById('menu').scrollLeft = localStorage.getItem("menu-scroll-position");
        }
    }
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

    function menu_on_scroll() {
        localStorage.setItem("menu-scroll-position", document.getElementById('menu').scrollLeft);
    }

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>

</body>

</html>
