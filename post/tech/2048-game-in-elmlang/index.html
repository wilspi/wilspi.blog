<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Learning Elm: 2048 game in Elm | Sourabh Deokar</title>

<meta name="keywords" content="elm, frontend" />
<meta name="description" content="Elm is a front-end programming language optimized for developer&rsquo;s happiness. Elm basics are very straightforward, which is just the Elm Architecture.
The Elm Architecture  Model — the state of your application View — a way to turn your state into HTML Update — a way to update your state based on messages  You can read more about Elm here.
Here, we will construct the famous game: 2048 in Elm.">
<meta name="author" content="wilspi">
<link rel="canonical" href="https://wilspi.com/post/tech/2048-game-in-elmlang/" />
<link href="/assets/css/stylesheet.min.f580a29692e0c7eb72865ec0bd4ee916bef2dc7e85f4fbfdf6a609b3a0f4f6a1.css" integrity="sha256-9YCilpLgx&#43;tyhl7AvU7pFr7y3H6F9Pv99qYJs6D09qE=" rel="preload stylesheet"
    as="style">

<link rel="icon" href="https://wilspi.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://wilspi.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://wilspi.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://wilspi.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://wilspi.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.79.0" />



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-51915090-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<meta property="og:title" content="Learning Elm: 2048 game in Elm" />
<meta property="og:description" content="Elm is a front-end programming language optimized for developer&rsquo;s happiness. Elm basics are very straightforward, which is just the Elm Architecture.
The Elm Architecture  Model — the state of your application View — a way to turn your state into HTML Update — a way to update your state based on messages  You can read more about Elm here.
Here, we will construct the famous game: 2048 in Elm." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://wilspi.com/post/tech/2048-game-in-elmlang/" />
<meta property="og:image" content="https://wilspi.com/images/cover.jpg"/>
<meta property="article:published_time" content="2020-08-08T15:00:00+05:30" />
<meta property="article:modified_time" content="2020-08-08T15:00:00+05:30" /><meta property="og:site_name" content="नमस्ते" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://wilspi.com/images/cover.jpg"/>

<meta name="twitter:title" content="Learning Elm: 2048 game in Elm"/>
<meta name="twitter:description" content="Elm is a front-end programming language optimized for developer&rsquo;s happiness. Elm basics are very straightforward, which is just the Elm Architecture.
The Elm Architecture  Model — the state of your application View — a way to turn your state into HTML Update — a way to update your state based on messages  You can read more about Elm here.
Here, we will construct the famous game: 2048 in Elm."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://wilspi.com/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Learning Elm: 2048 game in Elm",
      "item": "https://wilspi.com/post/tech/2048-game-in-elmlang/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Learning Elm: 2048 game in Elm",
  "name": "Learning Elm: 2048 game in Elm",
  "description": "Elm is a front-end programming language optimized for developer\u0026amp;rsquo;s happiness. Elm basics are very straightforward, which is just the Elm Architecture.\nThe Elm Architecture …",
  "keywords": [
    "elm", "frontend"
  ],
  "articleBody": "Elm is a front-end programming language optimized for developer’s happiness. Elm basics are very straightforward, which is just the Elm Architecture.\nThe Elm Architecture  Model — the state of your application View — a way to turn your state into HTML Update — a way to update your state based on messages  You can read more about Elm here.\nHere, we will construct the famous game: 2048 in Elm.\n2048 Game 2048 is a game created by gabrielecirulli which went viral in 2014. We are recreating 2048 because the functioning of the game is very simple which will help us understand the elm architecture very clearly. Let’s call it a replacement for the TODO app for learning.\nYou can play it here.\nRules of the game The rules of the game are:\n 2 similar tiles (same number) can be merged into one, doubling the value on the tile Merging happens in the direction of the key-press A new tile (number 2) is introduced in the game at a random empty space with every key-press Game is over when no new tiles can be added  Structuring the design Based on the above rules, let’s start defining the architecture of our game from Elm’s perspective:\nModel\nWe have to store every tile’s data (number on the tiles and position of the tile). To store these tiles, we can construct and use a matrix of NxN (N being the number of rows/columns, here 4).\nView\nThe View is simple, we have to render this matrix, beautifully with CSS.\nUpdate\nUpdate function will regenerate the model (state) depending upon the message it receives. Let’s look at different kind of messages we must have:\n LeftMove: To enable merging towards the left side RightMove: To enable merging towards the right side UpMove: To enable merging upwards DownMove: To enable merging downwards side Reset: For resetting the grid to the initial state AddTile: To add a tile at any random available space  The structure of the game looks good, now we have to implement the handling of these messages.\nDiving deep into our messages   LeftMove\nSince the tiles are in List of List fashion (tiles in row 1 are in the same list), we can do map-reduce for rows and merge 2 tiles with the same number into one and double the number on the tile. Lets look at the code below, which merges tiles in a list and returns the list:\nmergeAndFillRow : List Cell - List Cell mergeAndFillRow list = let updatedRow = mergeRow list in List.concat (updatedRow :: [ EmptyCell | List.repeat ((list | List.length) - (updatedRow | List.length)) ] ) mergeRow : List Cell - List Cell mergeRow list = case list of [] - [] x1 :: xs - if x1 == EmptyCell then mergeRow xs else case xs of [] - [ x1 ] x2 :: xs2 - if x1 == x2 then mergeCell ( x1, x2 ) :: mergeRow xs2 else x1 :: mergeRow (x2 :: xs2) In mergeRow, we use recursion to reduce the list, and then in mergeAndFillRow we fill the list with empty tiles.\n  RightMove\nRightMove is the same as LeftMove, in the opposite direction. So to reuse mergeAndFillRow we will do List reverse before and after calling this function.\n  UpMove\nFor RightMove, and LeftMove, the merging operation was fairly easy since the same row elements were in a single list and therefore we could use List methods to reduce and merge tiles, but in this case, the tiles are in column (column 1 tiles are in different lists). Thinking on the same lines as doing the reverse, here we can transpose the matrix and then call the function mergeAndFillRow.\nTranspose is little challenging when we can’t use looping (for/while) constructs, you can refer to the code below (uses recursion):\ntransposeMap : Grid - Grid - Grid transposeMap grid2 grid1 = case Array.get 0 grid1 of Just e - transposeMap (grid2 | transposeForIdx 0 e) (grid1 | Array.slice 1 (grid1 | Array.length)) Nothing - grid2 transposeForIdx : Int - Array Cell - Grid - Grid transposeForIdx idx list grid2 = case Array.get 0 list of Just e - transposeForIdx (idx + 1) (list | Array.slice 1 (list | Array.length)) (case grid2 | Array.get idx of Just l - grid2 | Array.set idx (l | Array.push e) Nothing - grid2 | Array.push (Array.fromList [ e ]) ) Nothing - grid2   DownMove\nUsing the same technique as we did in RightMove, we can first reverse the list, then transpose, call mergeAndFillRow, transpose again, and finally reverse.\n  AddTile\nFor this will create a list of available positions and randomly select one of them.\n  Reset\nReset is initializing the matrix and sending AddTile message.\n  Common functions:\nmergeCell is a common function which merges 2 tiles (Cell) and returns one tile:\nswap : ( Cell, Cell ) - ( Cell, Cell ) swap ( cell1, cell2 ) = ( cell2, cell1 ) mergeCell : ( Cell, Cell ) - Cell mergeCell ( cell1, cell2 ) = case ( cell1, cell2 ) of ( Tile val1, Tile val2 ) - Tile (val1 + val2) ( Tile val1, EmptyCell ) - Tile val1 _ - mergeCell (swap ( cell1, cell2 )) Note: The above mergeCell method fails when arguments are EmptyCell and EmptyCell, it gets stuck in infinite recursion. But since we never use that case, it never crashed.\nFor integrating key-presses and touch coordinates, we will use subscriptions.\nYou can look at the complete code here.\n",
  "wordCount" : "913",
  "inLanguage": "en",
  "datePublished": "2020-08-08T15:00:00+05:30",
  "dateModified": "2020-08-08T15:00:00+05:30",
  "author":{
    "@type": "Person",
    "name": "wilspi"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://wilspi.com/post/tech/2048-game-in-elmlang/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Sourabh Deokar",
    "logo": {
      "@type": "ImageObject",
      "url": "https://wilspi.com/favicon.ico"
    }
  }
}
</script>





</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://wilspi.com" accesskey="h" title="Sourabh Deokar (Alt + H)">Sourabh Deokar</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                
                
            </span>
        </div>
        <ul id="menu" onscroll="menu_on_scroll()">
            <li>
                <a href="https://wilspi.com/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://notes.wilspi.com" title="Notes">
                    <span>Notes</span>
                </a>
            </li></ul>
    </nav>
</header>

    <main class="main">

<article class="post-single">
  <header class="post-header">

    <h1 class="post-title">
      Learning Elm: 2048 game in Elm
    </h1>
    <div class="post-meta">

August 8, 2020&nbsp;·&nbsp;5 min&nbsp;·&nbsp;wilspi

</div>
  </header> 

  <div class="toc">
    <details >
      <summary accesskey="c" title="(Alt + C)">
        <div class="details">Table of Contents</div>
      </summary>
      <div class="inner"><ul><ul><ul><li>
        <a href="#the-elm-architecture" aria-label="The Elm Architecture">The Elm Architecture</a></li></ul>
        </ul>
        <li>
        <a href="#2048-game" aria-label="2048 Game">2048 Game</a><ul>
            <li>
        <a href="#rules-of-the-game" aria-label="Rules of the game">Rules of the game</a></li><li>
        <a href="#structuring-the-design" aria-label="Structuring the design">Structuring the design</a></li><li>
        <a href="#diving-deep-into-our-messages" aria-label="Diving deep into our messages">Diving deep into our messages</a></li></ul>
</li></ul>
      </div>
    </details>
  </div>
  <div class="post-content">
<p><a href="https://elm-lang.org/">Elm</a> is a front-end programming language optimized for developer&rsquo;s happiness. Elm basics are very straightforward, which is just the Elm Architecture.</p>
<h4 id="the-elm-architecture">The Elm Architecture<a hidden class="anchor" aria-hidden="true" href="#the-elm-architecture">#</a></h4>
<ul>
<li><strong>Model</strong> — the state of your application</li>
<li><strong>View</strong> — a way to turn your state into HTML</li>
<li><strong>Update</strong> — a way to update your state based on messages</li>
</ul>
<p>You can read more about Elm <a href="/post/tech/2048-game-in-elmlang#extra">here</a>.</p>
<p>Here, we will construct the famous game: 2048 in Elm.</p>
<h2 id="2048-game">2048 Game<a hidden class="anchor" aria-hidden="true" href="#2048-game">#</a></h2>
<p>2048 is a game created by <a href="https://github.com/gabrielecirulli/2048">gabrielecirulli</a> which went viral in 2014.
We are recreating 2048 because the functioning of the game is very simple which will help us understand the elm architecture very clearly. Let&rsquo;s call it a replacement for the <code>TODO</code> app for learning.</p>
<p><img src="/images/2048.png" alt="2048"></p>
<p>You can play it <a href="/elm-2048">here</a>.</p>
<h3 id="rules-of-the-game">Rules of the game<a hidden class="anchor" aria-hidden="true" href="#rules-of-the-game">#</a></h3>
<p>The rules of the game are:</p>
<ul>
<li>2 similar tiles (same number) can be merged into one, doubling the value on the tile</li>
<li>Merging happens in the direction of the key-press</li>
<li>A new tile (number 2) is introduced in the game at a random empty space with every key-press</li>
<li>Game is over when no new tiles can be added</li>
</ul>
<h3 id="structuring-the-design">Structuring the design<a hidden class="anchor" aria-hidden="true" href="#structuring-the-design">#</a></h3>
<p>Based on the above rules, let&rsquo;s start defining the architecture of our game from Elm&rsquo;s perspective:</p>
<p><strong>Model</strong><br>
We have to store every tile&rsquo;s data (number on the tiles and position of the tile). To store these tiles, we can construct and use a matrix of <code>N</code>x<code>N</code> (<code>N</code> being the number of rows/columns, here 4).</p>
<!-- raw HTML omitted -->
<p><strong>View</strong><br>
The View is simple, we have to render this matrix, beautifully with CSS.</p>
<p><strong>Update</strong><br>
Update function will regenerate the model (state) depending upon the message it receives. Let&rsquo;s look at different kind of messages we must have:</p>
<ul>
<li>LeftMove: To enable merging towards the left side</li>
<li>RightMove: To enable merging towards the right side</li>
<li>UpMove: To enable merging upwards</li>
<li>DownMove: To enable merging downwards side</li>
<li>Reset: For resetting the grid to the initial state</li>
<li>AddTile: To add a tile at any random available space</li>
</ul>
<p>The structure of the game looks good, now we have to implement the handling of these messages.</p>
<h3 id="diving-deep-into-our-messages">Diving deep into our messages<a hidden class="anchor" aria-hidden="true" href="#diving-deep-into-our-messages">#</a></h3>
<ul>
<li>
<p><strong>LeftMove</strong></p>
<p>Since the tiles are in List of List fashion (tiles in row 1 are in the same list), we can do map-reduce for rows and merge 2 tiles with the same number into one and double the number on the tile.
Lets look at the code below, which merges tiles in a list and returns the list:</p>
<pre><code>mergeAndFillRow : List Cell -&gt; List Cell
mergeAndFillRow list =
    let
        updatedRow =
            mergeRow list
    in
    List.concat
        (updatedRow
            :: [ EmptyCell
                    |&gt; List.repeat
                        ((list |&gt; List.length) - (updatedRow |&gt; List.length))
               ]
        )


mergeRow : List Cell -&gt; List Cell
mergeRow list =
    case list of
        [] -&gt;
            []

        x1 :: xs -&gt;
            if x1 == EmptyCell then
                mergeRow xs

            else
                case xs of
                    [] -&gt;
                        [ x1 ]

                    x2 :: xs2 -&gt;
                        if x1 == x2 then
                            mergeCell ( x1, x2 ) :: mergeRow xs2

                        else
                            x1 :: mergeRow (x2 :: xs2)



</code></pre><p>In <code>mergeRow</code>, we use recursion to reduce the list, and then in <code>mergeAndFillRow</code> we fill the list with empty tiles.</p>
</li>
<li>
<p><strong>RightMove</strong></p>
<p>RightMove is the same as LeftMove, in the opposite direction. So to reuse <code>mergeAndFillRow</code> we will do List reverse before and after calling this function.</p>
</li>
<li>
<p><strong>UpMove</strong></p>
<p>For RightMove, and LeftMove, the merging operation was fairly easy since the same row elements were in a single list and therefore we could use <code>List</code> methods to reduce and merge tiles, but in this case, the tiles are in column (column 1 tiles are in different lists).
Thinking on the same lines as doing the reverse, here we can <a href="https://en.wikipedia.org/wiki/Transpose">transpose</a> the matrix and then call the function <code>mergeAndFillRow</code>.<br>
Transpose is little challenging when we can&rsquo;t use looping (for/while) constructs, you can refer to the code below (uses recursion):</p>
<pre><code>transposeMap : Grid -&gt; Grid -&gt; Grid
transposeMap grid2 grid1 =
    case Array.get 0 grid1 of
        Just e -&gt;
            transposeMap (grid2 |&gt; transposeForIdx 0 e) (grid1 |&gt; Array.slice 1 (grid1 |&gt; Array.length))

        Nothing -&gt;
            grid2


transposeForIdx : Int -&gt; Array Cell -&gt; Grid -&gt; Grid
transposeForIdx idx list grid2 =
    case Array.get 0 list of
        Just e -&gt;
            transposeForIdx (idx + 1)
                (list |&gt; Array.slice 1 (list |&gt; Array.length))
                (case grid2 |&gt; Array.get idx of
                    Just l -&gt;
                        grid2 |&gt; Array.set idx (l |&gt; Array.push e)

                    Nothing -&gt;
                        grid2 |&gt; Array.push (Array.fromList [ e ])
                )

        Nothing -&gt;
            grid2
</code></pre></li>
<li>
<p><strong>DownMove</strong></p>
<p>Using the same technique as we did in RightMove, we can first reverse the list, then transpose, call <code>mergeAndFillRow</code>, transpose again, and finally reverse.</p>
</li>
<li>
<p><strong>AddTile</strong></p>
<p>For this will create a list of available positions and randomly select one of them.</p>
</li>
<li>
<p><strong>Reset</strong></p>
<p>Reset is initializing the matrix and sending <code>AddTile</code> message.</p>
</li>
</ul>
<p>Common functions:</p>
<p><code>mergeCell</code> is a common function which merges 2 tiles (Cell) and returns one tile:</p>
<pre><code>swap : ( Cell, Cell ) -&gt; ( Cell, Cell )
swap ( cell1, cell2 ) =
    ( cell2, cell1 )


mergeCell : ( Cell, Cell ) -&gt; Cell
mergeCell ( cell1, cell2 ) =
    case ( cell1, cell2 ) of
        ( Tile val1, Tile val2 ) -&gt;
            Tile (val1 + val2)

        ( Tile val1, EmptyCell ) -&gt;
            Tile val1

        _ -&gt;
            mergeCell (swap ( cell1, cell2 ))
</code></pre><p>Note: The above <code>mergeCell</code> method fails when arguments are <code>EmptyCell</code> and <code>EmptyCell</code>, it gets stuck in infinite recursion. But since we never use that case, it never crashed.</p>
<p>For integrating key-presses and touch coordinates, we will use <a href="https://elmprogramming.com/subscriptions.html#subscription">subscriptions</a>.</p>
<p>You can look at the complete code <a href="https://github.com/wilspi/elm-2048/blob/master/src/Main.elm">here</a>.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->

</div>
  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://wilspi.com/tags/elm/">elm</a></li>
      <li><a href="https://wilspi.com/tags/frontend/">frontend</a></li>
    </ul>
  </footer>
</article>
    </main><footer class="footer">
    <span>&copy; 2021 <a href="https://wilspi.com">Sourabh Deokar</a></span>
    <span>&middot;</span>
    <span>Powered by <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a></span>
    <span>&middot;</span>
    <span>Theme <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>



<script defer src="/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js" integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w="
    onload="hljs.initHighlightingOnLoad();"></script>
<script>
    window.onload = function () {
        if (localStorage.getItem("menu-scroll-position")) {
            document.getElementById('menu').scrollLeft = localStorage.getItem("menu-scroll-position");
        }
    }
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

    function menu_on_scroll() {
        localStorage.setItem("menu-scroll-position", document.getElementById('menu').scrollLeft);
    }

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>

</body>

</html>
